<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
        <title>AJ Framework-ç»Ÿä¸€è¿”å›ã€ç»Ÿä¸€å¼‚å¸¸</title>
        <meta
            name="description"
            content="AJ Framework ä¸€ä¸ªåŸºäº SpringMVC æ„å»ºçš„è½»é‡çº§æ¡†æ¶ï¼Œæ—¨åœ¨å¢å¼º SpringMVC å¹¶ä½¿å…¶æ›´å…· SpringBoot çš„ç‰¹æ€§ã€‚å®ƒæ‹¥æœ‰è®¸å¤šå°å‹ç»„ä»¶ï¼Œéå¸¸æ˜“äºä½¿ç”¨ã€‚"/>
        <meta name="keywords" content="AJ Framework, ajaxjs, ajaxjs framework, java framework, web framewwork"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200..900&family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap&family=Noto+Sans+SC:wght@100..900&display=swap" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100..900&family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" /> 
        <link rel="stylesheet" href="/style/docs/main.css"/>
        <link rel="icon" type="image/x-icon" href="/asset/aj-docs/logo.ico"/>
        <script src="/asset/docs/js/common.js"></script>
    </head>
    <body>
        <nav>
            <div>
                <div class="links">
                    <a href="/">ğŸ  Home</a>
                    |
                                    âš™ï¸ Source:
                    <a target="_blank" href="https://github.com/lightweight-component/SqlMan">Github</a>/<a target="_blank" href="https://gitcode.com/lightweight-component/SqlMan/overview">Gitcode</a>
                    |
                    <a href="/docs/common/contact">âœ‰ï¸ Contact</a>
                </div>
                <h1>
                    <img src="/asset/aj-docs/logo.png" style="vertical-align: middle;height: 45px;margin-bottom: 6px;" /> 
                    AJ Framework
                </h1>
                <h3>è½»é‡çº§ Java å¿«é€Ÿå¼€å‘æ¡†æ¶
                </h3>
            </div>
        </nav>
        <div>
            <menu>
                
                <ul>
                    <li class="selected">
                        <a href="/aj-docs">é¦–é¡µ</a>
                    </li>
                    <li>
                        <a href="/aj-docs/quick-start">å¿«é€Ÿå¼€å§‹</a>
                    </li>
                </ul>
                <h3>å¼€å§‹</h3>
                <ul>
                    <li>
                        <a href="pages/api/init.html">åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®</a>
                    </li>
                    <li>
                        <a href="/aj-docs/init/controller">ç®€åŒ–æ§åˆ¶å™¨ä¸ºæ¥å£</a>
                    </li>
                    <li>
                        <a href="/aj-docs/init/global">ç»Ÿä¸€è¿”å›ã€ç»Ÿä¸€å¼‚å¸¸</a>
                    </li>
                    <li>
                        <a href="pages/api/package.html">æ‰“åŒ…ä¸éƒ¨ç½²</a>
                    </li>
                </ul>
                <h3>API åŠŸèƒ½</h3>
                <ul>
                    <li class="data">
                        <a href="/aj-docs/api/api-limit/">API é™æµ</a>
                    </li>
                    <li>
                        <a href="/aj-docs/api/api-encode/">API åŠ å¯†/è§£å¯†</a>
                    </li>
                    <li>
                        <a href="/aj-docs/api/api-security/">API å®‰å…¨</a>
                    </li>
                    <li>
                        <a href="/aj-docs/api/bean-validator/">Bean å®ä½“æ ¡éªŒ</a>
                    </li>
                </ul>
                <h3>å…¶ä»–æ¨¡å—</h3>
                <ul>
                    <li>
                        <a href="/aj-docs/misc/cache">ä½¿ç”¨å¤šçº§ç¼“å­˜</a>
                    </li>
                    <li>
                        <a href="/aj-docs/misc/desensitize">è„±æ•ç»„ä»¶</a>
                    </li>
                    <li>
                        <a href="/aj-docs/misc/trace">é“¾è·¯è·Ÿè¸ª</a>
                    </li>
                    <li>
                        <a href="/aj-docs/misc/dlock">åˆ†å¸ƒå¼é”ã€å»¶è¿Ÿæ¶ˆæ¯</a>
                    </li>
                </ul>
    
                <h3>Misc</h3>
                <ul>
                    <li><a href="/aj-docs/common/versions">Release History</a></li>
                    <li><a href="/aj-docs/common/contact">Contact</a></li>
                </ul>
            </menu>
            <article>
                <h1>ç»Ÿä¸€è¿”å›ã€ç»Ÿä¸€å¼‚å¸¸</h1>
<h1>ç»Ÿä¸€è¿”å›ç»“æœ</h1>
<p>å¼€å‘ REST API æ¥å£æ—¶å¾€å¾€éœ€è¦å’Œå‰ç«¯å¯¹æ¥å®šä¹‰è¿”å›çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚æ‰€æœ‰è¿”å› JSON æ ¼å¼æ•°æ®çš„æ¥å£éƒ½éœ€è¦è¿”å›ä¸‹é¢æ ¼å¼çš„æ•°æ®ã€‚</p>
<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;code&quot;: null,
  &quot;msg&quot;: &quot;æ“ä½œæˆåŠŸ!&quot;,
  &quot;data&quot;: å…·ä½“çš„æ•°æ®
}
</code></pre>
<p>ä½†æ˜¯å’±ä»¬ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ¥å£è¿”å›å€¼éƒ½æ˜¯ä¸‹é¢è¿™ç§æ ¼å¼çš„ï¼Œéš¾é“å’±ä»¬è¦ä¸€ä¸ªä¸ªå»æ‰‹åŠ¨æ”¹ä¸€ä¸‹æ¥å£çš„è¿”å›å€¼ä¹ˆï¼Ÿ</p>
<pre><code class="language-java">@PostMapping(&quot;/submit&quot;)
boolean jsonSubmit(@RequestBody User user);

@GetMapping(&quot;/user&quot;)
User User();

@GetMapping(&quot;/user_desensitize&quot;)
User UserDesensitize();
</code></pre>
<p>Spring ä¸ºæˆ‘ä»¬æä¾›äº†æ›´ç®€å•çš„æ–¹æ³•ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>RequestBodyAdvice</code>æ¥æ‹¦æˆªæ‰€æœ‰æ¥å£ï¼Œå°†æ¥å£çš„è¿”å›å€¼åŒ…è£…ä¸€ä¸‹ï¼ŒåŒ…è£…ä¸ºç»Ÿä¸€çš„æ ¼å¼è¿”å›ï¼Œä¸‹é¢æ¥çœ‹å…·ä½“ä»£ç å¦‚ä½•å®ç°ã€‚</p>
<blockquote>
<p>è¿™é‡Œæˆ‘ä»¬ä¸ä¸»å¼ ä½¿ç”¨<code>ResponseResultWrapper&lt;T&gt;</code>æ¥åŒ…è£…è¿”å›å€¼ï¼Œè€Œæ˜¯â€œéšå¼â€ä½¿ç”¨<code>ResponseResultWrapper</code>ï¼Œæ²¡æœ‰æ³›å‹ï¼Œä¸ç”¨å‡ºç°åœ¨æ§åˆ¶å™¨ä¸Šã€‚æ§åˆ¶å™¨ç›´æ¥ä½¿ç”¨ä¸šåŠ¡å¯¹è±¡æˆ–è€…<code>boolean</code>ã€<code>String</code>ç­‰è¿”å›å³å¯ï¼Œè¿™æ ·ä»£ç æ˜¾ç¤ºæ›´æ¸…çˆ½ï¼Œå‡å°‘å¿ƒæ™ºã€‚</p>
<p>å¦å¤–æœ‰äººé‡‡ç”¨ AOP å®ç°æ‹¦æˆªï¼Œç¬”è€…è®¤ä¸ºå¤§å¯ä¸å¿…ï¼Œ<code>RequestBodyAdvice</code>æœ¬èº«å°±å¯æ‹¦æˆª</p>
</blockquote>
<pre><code class="language-java">@RestControllerAdvice
@Component
public class GlobalResponseResult implements ResponseBodyAdvice&lt;Object&gt; {
    @Override
    public boolean supports(MethodParameter returnType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType) {
//        System.out.println(&quot;supports:&quot; + returnType);
        return true;
    }

    private static final String OK = &quot;æ“ä½œæˆåŠŸ&quot;;

    @Override
    public Object beforeBodyWrite(Object body, MethodParameter returnType, MediaType selectedContentType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; selectedConverterType, ServerHttpRequest request, ServerHttpResponse response) {
        Method method = returnType.getMethod();
        assert method != null;

        if (method.isAnnotationPresent(Desensitize.class))
            body=  DeSensitize.acquire(body);

        if (method.isAnnotationPresent(IgnoredGlobalReturn.class))
            return body;

        ResponseResultWrapper responseResult = new ResponseResultWrapper();
        responseResult.setStatus(1);

        JsonMessage annotation = Objects.requireNonNull(returnType.getMethod()).getAnnotation(JsonMessage.class);

        if (annotation != null)
            responseResult.setMessage(annotation.value());
        else
            responseResult.setMessage(OK);

        responseResult.setData(body);

        return responseResult;
    }
}
</code></pre>
<p>å¯è§ä»£ç ä¸è¿‡å¯¥å¯¥æ•°è¡Œï¼Œç®€å•è¯´å°±æ˜¯æŠŠæ§åˆ¶å™¨æ‰€è¿”å›çš„ç»“æœï¼ˆä¸šåŠ¡ç»“æœï¼‰åµŒå…¥åˆ°<code>ResponseResultWrapper</code>ï¼Œè¿ JSON åºåˆ—åŒ–éƒ½ä¸ç”¨ï¼ˆåºåˆ—åŒ–åœ¨å¦å¤–çš„åœ°æ–¹ç»Ÿä¸€å¤„ç†ï¼‰ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯å‡ ä¸ªæ³¨è§£ï¼š</p>
<ul>
<li><code>Desensitize</code> è¡¨ç¤ºè¯¥æ–¹æ³•è¿”å›çš„ç»“æœè¦è¿›è¡Œè„±æ•</li>
<li><code>IgnoredGlobalReturn</code> å¿½ç•¥å…¨å±€è¿”å›ï¼Œç›´æ¥è¿”å›ä¸šåŠ¡å¯¹è±¡</li>
<li><code>JsonMessage</code> è¿”å› JSON ç»“æ„æ—¶å€™ï¼Œè‡ªå®šä¹‰ message å†…å®¹</li>
</ul>
<h1>ç»Ÿä¸€å¼‚å¸¸å¤„ç†</h1>
<h2>ä½¿ç”¨å…¨å±€å¼‚å¸¸å¤„ç†å™¨</h2>
<p>æœ‰äº›å°ä¼™ä¼´ï¼Œç»å¸¸å–œæ¬¢åœ¨ Controllerã€Service ä»£ç ä¸­æ•è·å¼‚å¸¸ã€‚ä¸ç®¡æ˜¯æ™®é€šå¼‚å¸¸ Exceptionï¼Œè¿˜æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ RuntimeExceptionï¼Œéƒ½ä½¿ç”¨<code>try/catch</code>æŠŠå®ƒä»¬æ•è·ã€‚
åä¾‹ï¼š</p>
<pre><code class="language-java">try {
    checkParam(param);
} catch (BusinessException e) {
    return ApiResultUtil.error(1,&quot;å‚æ•°é”™è¯¯&quot;);
}
</code></pre>
<p>æ˜¾ç„¶è¿™ç§åšæ³•ä¼šé€ æˆå¤§é‡é‡å¤çš„ä»£ç ã€‚æˆ‘ä»¬åœ¨ Controllerã€Service ç­‰ä¸šåŠ¡ä»£ç ä¸­ï¼Œå°½å¯èƒ½å°‘æ•è·å¼‚å¸¸ã€‚è¿™ç§ä¸šåŠ¡å¼‚å¸¸å¤„ç†ï¼Œåº”è¯¥äº¤ç»™æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†ã€‚æœ‰äº†è¿™ä¸ªå…¨å±€çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œä¹‹å‰æˆ‘ä»¬åœ¨ Controller æˆ–è€… Service ä¸­çš„<code>try/catch</code>ä»£ç å¯ä»¥å»æ‰ã€‚</p>
<p>å¦‚æœåœ¨æ¥å£ä¸­å‡ºç°å¼‚å¸¸ï¼Œå…¨å±€çš„å¼‚å¸¸å¤„ç†å™¨<code>HandlerExceptionResolver</code>ä¼šå¸®æˆ‘ä»¬å°è£…ç»“æœï¼Œè¿”å›ç»™ç”¨æˆ·ã€‚å…·ä½“å®ç°è¯·çœ‹<span class="external-link">
<span>â†—</span>
</span><a href="https://gitcode.com/zhangxin09/aj-framework/blob/master/aj-framework/src/main/java/com/ajaxjs/springboot/GlobalExceptionHandler.java"><code>GlobalExceptionHandler</code></a>ï¼Œéå¸¸ç®€å•ã€‚æ‰€æœ‰å¼‚å¸¸åˆ°è·‘åˆ°è¿™é‡Œæ¥æ‰“å°ï¼Œæ ¹æ®å…·ä½“çš„å¼‚å¸¸è¿”å›ç‰¹å®šçš„ HTTP Status Codeï¼Œæ¯”å¦‚ <code>SecurityException</code>ã€<code>IllegalAccessError</code>ã€<code>IllegalAccessException</code> è¿”å› 403ã€‚</p>
<h2>ä¼˜å…ˆä½¿ç”¨æ ‡å‡†å¼‚å¸¸</h2>
<p>åœ¨ Java ä¸­å·²ç»å®šä¹‰äº†è®¸å¤šæ¯”è¾ƒå¸¸ç”¨çš„æ ‡å‡†å¼‚å¸¸ï¼Œæ¯”å¦‚ä¸‹é¢è¿™å¼ å›¾ä¸­åˆ—å‡ºçš„è¿™äº›å¼‚å¸¸ã€‚</p>
<ul>
<li><code>IllegalArgumentException</code> å…¥å‚ä¸åˆæ³•</li>
<li><code>IllegalStateException</code> å…¥å‚çš„çŠ¶æ€ä¸åˆæ³•</li>
<li><code>UnsupportedOperationException</code> ä¸æ”¯æŒçš„æ“ä½œ</li>
<li><code>SecurityException</code> å®‰å…¨å¼‚å¸¸ è¿”å› 401/403</li>
<li><code>NullPointerException</code> ç©ºæŒ‡é’ˆå¼‚å¸¸ è¿”å› 500</li>
</ul>
<p>åä¾‹ï¼š</p>
<pre><code class="language-java">public void checkValue(int value) {
    if (value &lt; 0) {
        throw new MyIllegalArgumentException(&quot;å€¼ä¸èƒ½ä¸ºè´Ÿ&quot;);
    }
}
</code></pre>
<p>è‡ªå®šä¹‰äº†ä¸€ä¸ªå¼‚å¸¸è¡¨ç¤ºå‚æ•°é”™è¯¯ã€‚å…¶å®æˆ‘ä»¬å¯ä»¥ç›´æ¥å¤ç”¨å·²æœ‰çš„æ ‡å‡†å¼‚å¸¸ã€‚</p>
<p>æ­£ä¾‹ï¼š</p>
<pre><code class="language-java">public void checkValue(int value) {
    if (value &lt; 0) {
        throw new IllegalArgumentException(&quot;å€¼ä¸èƒ½ä¸ºè´Ÿ&quot;);
    }
}
</code></pre>
<h2>å°½å¯èƒ½æ•è·å…·ä½“å¼‚å¸¸</h2>
<p>åœ¨ä½ çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•ä¸­ï¼Œæœ‰å¯èƒ½éœ€è¦å»å¤„ç†å¤šç§ä¸åŒçš„å¼‚å¸¸ã€‚ ä½ å¯èƒ½ä½ ä¼šè§‰å¾—æ¯”è¾ƒéº»çƒ¦ï¼Œè€Œç›´æ¥æ•è·<code>Exception</code>ã€‚</p>
<p>åä¾‹ï¼š</p>
<pre><code class="language-java">try {
    doSomething();
} catch(Exception e) {
    log.error(&quot;doSomethingå¤„ç†å¤±è´¥ï¼ŒåŸå› ï¼š&quot;,e);
}
</code></pre>
<p>è¿™æ ·æ•è·å¼‚å¸¸å¤ªç¬¼ç»Ÿäº†ã€‚ å…¶å®<code>doSomething</code>æ–¹æ³•ä¸­ï¼Œä¼šæŠ›å‡º<code>FileNotFoundException</code>å’Œ<code>IOException</code>ã€‚ è¿™ç§æƒ…å†µæˆ‘ä»¬æœ€å¥½æ•è·å…·ä½“çš„å¼‚å¸¸ï¼Œç„¶ååˆ†åˆ«åšå¤„ç†ã€‚</p>
<p>æ­£ä¾‹ï¼š</p>
<pre><code class="language-java">try {
   doSomething();
} catch(FileNotFoundException e) {
  log.error(&quot;doSomethingå¤„ç†å¤±è´¥ï¼Œæ–‡ä»¶æ‰¾ä¸åˆ°ï¼ŒåŸå› ï¼š&quot;,e);
} catch(IOException e) {
  log.error(&quot;doSomethingå¤„ç†å¤±è´¥ï¼ŒIOå‡ºç°äº†å¼‚å¸¸ï¼ŒåŸå› ï¼š&quot;,e);
}
</code></pre>
<p>è¿™æ ·å¦‚æœåé¢å‡ºç°äº†ä¸Šé¢çš„å¼‚å¸¸ï¼Œæˆ‘ä»¬å°±éå¸¸æ–¹ä¾¿çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› äº†ã€‚</p>

            </article>
        </div>

        <footer>
    SqlMan, a part of <a href="https://framework.ajaxjs.com" target="_blank">AJ-Framework</a> open source. Mail:
    frank@ajaxjs.com, visit <a href="https://blog.csdn.net/zhangxin09" target="_blank">my blog(In Chinese)</a>.
    <br />
    <br />
     Copyright Â© 2025 Frank Cheung. All rights reserved.
</footer>
    </body>
</html>